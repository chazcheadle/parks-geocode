<!DOCTYPE html>
<html>
<head>
<title>Place searches</title>
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.11.2.min.js"></script>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
<meta charset="utf-8">
<style>
html {
  font-family: 'arial';
}
#results-container {
  width: 50%;
  float: left;
}
#map-container {
  width: 50%;
  float: left;
}
#map-canvas {
  height: 300px;
  width: 300px;
}
</style>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=places"></script>
<script>

parks = [
    "42.47729103310,-73.81325072900",
    "42.69614492160,-73.72734728390",
    "42.70443346800,-73.83483048940",
    "42.70385821600,-74.03482872710",
    "42.70687436340,-73.83506734530",
    "42.44789548980,-74.21218736740",
    "42.51062721170,-74.04253860750",
    "42.70163299880,-74.03200166150",
    "42.70111063520,-74.03249573530",
    "42.58262934860,-73.88283374710",
    "42.66620482830,-74.12338788270",
    "42.67096573020,-74.12805585870",
    "42.52165530140,-74.20960139900",
    "42.63811338880,-73.92837418200",
    "42.64167670480,-73.92755127820",
    "42.67752818780,-73.84290213440",
    "42.70039579500,-73.93403167830",
    "42.73379890010,-73.91553371350",
    "42.73490522990,-73.90579588140",
    "42.73595519760,-73.92753575960",
    "42.70674173270,-73.96756359230",
    "42.73743025740,-73.91005529060",
    "42.68472897050,-73.91139804750",
    "42.75044195960,-73.94650754340",
    "42.47602594870,-73.86287195400",
    "42.78088623100,-73.70903213620",
    "42.77265373010,-73.71127701760",
    "42.77462953410,-73.70049252120",
    "42.76507999990,-73.70255099530",
    "42.76283305600,-73.70216849480",
    "42.76366361750,-73.70287796990",
    "42.76200128010,-73.70256914770",
    "42.77525109390,-73.69641380030",
    "42.60826756060,-74.16107325070",
    "42.78432339490,-73.71177149560",
    "42.79283779930,-73.71492707700",
    "42.77699769180,-73.70249219210",
    "42.78016527630,-73.70604390840",
    "42.78028712510,-73.70666463110",
    "42.77917261910,-73.70575386200",
    "42.78166430570,-73.70691111940",
    "42.78239618120,-73.70738508380",
    "42.79013369840,-73.72565670320",
    "42.78376689730,-73.71163597130",
    "42.77049443230,-73.70815980650",
    "42.78153279280,-73.71887676330",
    "42.78201784710,-73.72031344900",
    "42.77036243820,-73.69910136170",
    "42.77392366910,-73.71093867820",
    "42.76803252830,-73.68891740850",
    "42.78268193160,-73.70988684110",
    "42.76843084700,-73.71021747320",
    "42.76568925610,-73.69393079410",
    "42.76545229280,-73.69267553930",
    "42.76575799290,-73.69257003330",
    "42.76596972890,-73.69369009930",
    "42.76640441880,-73.69358839030",
    "42.76622585090,-73.69264817220",
    "42.76615748460,-73.69228619470",
    "42.65430625730,-73.75041319110",
    "42.65787541740,-73.75390756920",
    "42.65660833200,-73.75164775400",
    "42.66081682420,-73.78125220080",
    "42.65971550460,-73.75342666500",
    "42.66317924800,-73.76114891890",
    "42.66311105030,-73.76111426370",
    "42.66307868840,-73.76105535600",
    "42.66304493800,-73.76099617280",
    "42.66321259930,-73.76091117660",
    "42.64399923570,-73.83398616290",
    "42.65768238230,-73.75859003180",
    "42.65757608400,-73.75844119590",
    "42.65256544520,-73.82184123960",
    "42.66892481850,-73.77428646000",
    "42.65932562070,-73.78857764960",
    "42.65926257670,-73.78846723800",
    "42.65920952120,-73.78837577840",
    "42.65914689820,-73.78826629140",
    "42.67738984560,-73.76074559190",
    "42.65937160140,-73.79872350230",
    "42.65930645040,-73.79879165820",
    "42.65947348030,-73.79908126410",
    "42.65953844150,-73.79901307450",
    "42.66992764430,-73.77503808670",
    "42.65905273090,-73.78810244750",
    "42.65896736940,-73.78795537410",
    "42.67132459190,-73.77777707990",
    "42.65690254170,-73.78848711590",
    "42.65774270340,-73.79000126430",
    "42.65940012970,-73.78870531090",
    "42.66001419940,-73.78795219990",
    "42.65695834020,-73.76918991060",
    "42.65760740750,-73.77395857150",
    "42.67206566010,-73.74148625700",
    "42.67178653090,-73.73887312630",
    "42.66278759700,-73.74418848220",
    "42.67096581760,-73.74301242920",
    "42.66510105710,-73.77900488160",
    "42.66799173140,-73.76711950880",
    "42.67321081150,-73.79099707830"
];

var map;

function lookupName() {
  if (document.getElementById("getCoords").value) {
    parks = [];
    parks = [document.getElementById("getCoords").value];
  }
  // Limit to 5 for testing.
  for (i = 0; i < 1; i++) {
    coords = parks[i].split(',');
    lat = coords[0];
    lng = coords[1];
    var lookupCoords = new google.maps.LatLng(coords[0], coords[1]);

    var request = {
      location: lookupCoords,
                radius: 1000,
                types: ['park']
    };
    // This is used for visual confirmation.
    map = new google.maps.Map(document.getElementById('map-canvas'), {
        center: lookupCoords,
        zoom: 15
    });
    
    var service = new google.maps.places.PlacesService(map);
    service.nearbySearch(request, callback);
    // Google's free Maps API + Places Library limits requests
    // to 1/sec/user && 1000/24hrs
    sleep(1001);
  }
}

function callback(results, status) {
  if (status == google.maps.places.PlacesServiceStatus.OK) {
    $('#controls').hide();
    if (results.length) {
      console.log(results);
      for (var i = 0; i < results.length; i++) {
        result = results[i].geometry.location.k + ', ' + results[i].geometry.location.D + ', ' + results[i].name + "</br>";
        $('#list').append(result);
      }
    }
  }
  else {
    console.log(google.maps.places.PlacesServiceStatus);
  }
}

function sleep(milliseconds) {
  var start = new Date().getTime();
  for (var i = 0; i < 1e7; i++) {
    if ((new Date().getTime() - start) > milliseconds){
       break;
    }
  }
}

</script>
</head>
<body>
<div id="controls">
  <div>
    <p>Enter a lat/long and click the button.</br>
    Results show will be the matches found within</br>
    a 500 meter radius with the Google Maps stored</br>
    geometry for those places.</p>
  </div>
  <input type="text" id="getCoords">
  <button id="getName" onClick="lookupName();">Lookup Name</button>
</div>
<div id="results-container">
  <div id="list"></div>
</div>
<div id="map-container">
  <div id="map-canvas"></div>
</div>
</body>
</html>
